"0","# split and run metrics to get unique stations and sampling stats associated"
"0","BRROdatalist <- split(conventionals,f=conventionals$FDT_STA_ID) # Split before FDT_STA_ID becomes factor"
"0","BRROdata_sites <- data.frame(FDT_STA_ID=NA,STA_LV3_CODE=NA,STA_LV1_CODE=NA,STA_REC_CODE=NA,Deq_Region=NA,"
"0","                             STA_DESC=NA,FDT_SSC_CODE=NA,FDT_SPG_CODE=NA,STA_LV2_CODE=NA,Latitude=NA,"
"0","                             Longitude=NA,Majorbasincode=NA,Majorbasinname=NA,Basin=NA,Subbasin=NA,"
"0","                             Huc6_Huc_8=NA,Huc6_Huc_8_Name=NA,Huc6_Name=NA,Huc6_Huc_12=NA,Huc6_Huc_12_Name=NA,"
"0","                             Huc6_Vahu5=NA,Huc6_Vahu6=NA,STA_CBP_NAME=NA,nObservations=NA,yearsSampled=NA,"
"0","                             nYearsSampled=NA, n_Samples_2011=NA, n_Samples_2012=NA, n_Samples_2013=NA,"
"0","                             n_Samples_2014=NA, n_Samples_2015=NA, n_Samples_2016=NA, n_Samples_2017=NA, "
"0","                             n_Samples_2018=NA,n_Samples_IR2018=NA, n_Samples_IR2020=NA, n_Samples_IR2022=NA)"
"0","template <- BRROdata_sites[,c(1,27:34)]"
"0","for(i in 1:length(BRROdatalist)){"
"0","  dat <- BRROdatalist[i][[1]]"
"0","  nObservations <- nrow(dat)"
"0","  yearsSampled <- unique(dat$FDT_YEAR)"
"0","  nYearsSampled <- length(yearsSampled)"
"0","  FDT_SPG_CODEall <- paste(as.character(unique(dat$FDT_SPG_CODE)), collapse = ', ') # combine different sampling codes if present"
"0","  "
"0","  # Find number of samples per year, which year, and type of sampling occurred at each site"
"0","  dat1 <- dat %>%"
"0","    group_by(FDT_STA_ID, FDT_YEAR, FDT_SPG_CODE) %>%"
"0","    summarise(nSamples = n(),"
"0","              SampleCodes = toString(unique(FDT_SPG_CODE))) "
"0","  dat1.1 <- dat1 %>%"
"0","    mutate(newColumnNames = paste('n_Samples_',FDT_YEAR,sep=''),"
"0","           nSamples = paste(nSamples, SampleCodes, sep = ' : ')) %>%"
"0","    # In case multiple sample codes per single year"
"0","    group_by(FDT_STA_ID, newColumnNames) %>%"
"0","    mutate(real_nSamples = paste0(nSamples, collapse = "" | "")) %>%"
"0","    ungroup() %>%"
"0","    distinct(FDT_STA_ID, newColumnNames, real_nSamples) %>%"
"0","    spread(newColumnNames, real_nSamples)"
"0","  # make sure all necessary columns are present"
"0","  dat1.2 <- template[is.na(match(names(template),names(dat1.1)))]"
"0","  dat1.3 <- data.frame(dat1.1, dat1.2)[,order(names(template))] "
"0","  "
"0","  # Find number of samples in IR windows "
"0","  dat2018 <- filter(dat1,FDT_YEAR >=2011 & FDT_YEAR <= 2016) %>%"
"0","    ungroup() %>%"
"0","    mutate(nSamplesIR = sum(nSamples)) %>%"
"0","    group_by(FDT_STA_ID, FDT_SPG_CODE) %>%"
"0","    mutate(nSampleTypeIR = sum(nSamples)) %>%"
"0","    distinct(FDT_STA_ID, nSampleTypeIR) %>%"
"0","    ungroup() %>%"
"0","    add_row(FDT_STA_ID= .$FDT_STA_ID[1], FDT_SPG_CODE= 'Total',"
"0","            nSampleTypeIR=sum(.$nSampleTypeIR)) %>%"
"0","    group_by(FDT_STA_ID) %>%"
"0","    mutate(n_Samples_IR2018 = paste0(FDT_SPG_CODE,"": "",nSampleTypeIR, collapse = "" | "")) %>%"
"0","    distinct(FDT_STA_ID, n_Samples_IR2018)"
"0","  dat2020 <- filter(dat1,FDT_YEAR >=2013 & FDT_YEAR <= 2018)%>%"
"0","    ungroup() %>%"
"0","    mutate(nSamplesIR = sum(nSamples)) %>%"
"0","    group_by(FDT_STA_ID, FDT_SPG_CODE) %>%"
"0","    mutate(nSampleTypeIR = sum(nSamples)) %>%"
"0","    distinct(FDT_STA_ID, nSampleTypeIR) %>%"
"0","    ungroup() %>%"
"0","    add_row(FDT_STA_ID= .$FDT_STA_ID[1], FDT_SPG_CODE= 'Total',"
"0","            nSampleTypeIR=sum(.$nSampleTypeIR)) %>%"
"0","    group_by(FDT_STA_ID) %>%"
"0","    mutate(n_Samples_IR2020 = paste0(FDT_SPG_CODE,"": "",nSampleTypeIR, collapse = "" | "")) %>%"
"0","    distinct(FDT_STA_ID, n_Samples_IR2020)"
"0","  dat2022 <- filter(dat1,FDT_YEAR >=2015 & FDT_YEAR <= 2020)%>%"
"0","    ungroup() %>%"
"0","    mutate(nSamplesIR = sum(nSamples)) %>%"
"0","    group_by(FDT_STA_ID, FDT_SPG_CODE) %>%"
"0","    mutate(nSampleTypeIR = sum(nSamples)) %>%"
"0","    distinct(FDT_STA_ID, nSampleTypeIR) %>%"
"0","    ungroup() %>%"
"0","    add_row(FDT_STA_ID= .$FDT_STA_ID[1], FDT_SPG_CODE= 'Total',"
"0","            nSampleTypeIR=sum(.$nSampleTypeIR)) %>%"
"0","    group_by(FDT_STA_ID) %>%"
"0","    mutate(n_Samples_IR2022 = paste0(FDT_SPG_CODE,"": "",nSampleTypeIR, collapse = "" | "")) %>%"
"0","    distinct(FDT_STA_ID, n_Samples_IR2022)"
"0","  "
"0","  "
"0","  dat <- mutate(dat,FDT_SPG_CODE = FDT_SPG_CODEall,"
"0","                nObservations = nObservations,"
"0","                yearsSampled = toString(yearsSampled), # another way to collapse strings to single string"
"0","                nYearsSampled = nYearsSampled)%>%"
"0","    select(-c(FDT_DATE_TIME,FDT_DATE,FDT_YEAR))%>% #remove redundant date/time info"
"0","    filter(row_number()==1) %>%"
"0","    left_join(dat1.3) %>%"
"0","    left_join(dat2018) %>%"
"0","    left_join(dat2020) %>%"
"0","    left_join(dat2022) %>%"
"0","    mutate_if(is.factor,as.character) # change factors to character to easily attach to BRROdata_sites without losing info"
"0","  "
"0","  BRROdata_sites[i,] <- dat"
"0","}"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","Joining, by = ""FDT_STA_ID""
"
"2","
"
